\ProvidesPackage{beamerinnerthemecorporate}

% ---------- %
% Title page %
% ---------- %
\defbeamertemplate*{title page}{corporate}[1][]
{ 
  \begin{tikzpicture}[remember picture, overlay]
    % Top rectangle
    \usebeamercolor{palette tertiary}
    \fill[color=fg]
      ([yshift=3cm] current page.south west)
      rectangle (current page.north east);

    % Title and subtitle
    \usebeamercolor{title page header}
    \coordinate (title corner) at ([shift={(0,3)}]current page.south east);
    \ifx\insertsubtitle\@empty%
    % Insert title
    {
      \node[
        text=fg,
        anchor=south east,
        font=\usebeamerfont{title}
      ] at ([shift={(-1em,+1em)}]title corner) {\inserttitle};
    }
    \else%
    % Insert subtitle, if one exists, doesn't work with overflow
    {
      \node[
        text=fg,
        anchor=south east,
        align=left
      ] at ([shift={(-2em,+1em)}] title corner) {
        \usebeamerfont{title}\inserttitle \\
        \hskip.4cm$\hookrightarrow$\hskip3pt\usebeamerfont{subtitle}\insertsubtitle
      };
    }
    \fi%

    % Bottom left rectangle
    \usebeamercolor{palette secondary}
    \fill[color=bg] (current page.south west) rectangle +(2.95cm,2.9cm);

    % Bottom right rectangle
    \usebeamercolor{palette primary}
    \fill[color=bg]
      ([shift={(3.05cm, 2.9cm)}] current page.south west)
      rectangle (current page.south east);

    % Author, institute and date
    \coordinate (info corner) at ([shift={(3.05,2.9)}] current page.south west);

    \ifx\insertauthor\@empty%
    \else%
    \usebeamercolor{author}
    \node[
      text=fg,
      anchor=north west,
      align=left,
      font=\usebeamerfont{author}
    ] at ([shift={(.5em,-.5em)}] info corner) (author) {\insertauthor};
    \fi

    \ifx\insertinstitute\@empty%
    \else%
    \usebeamercolor{institute}
    \node[
      text=fg,
      anchor=south west,
      align=left,
      font=\usebeamerfont{institute}
    ] at ([xshift=1mm] author.south east) (institute) {-\hspace{.25em}\insertinstitute};
    \fi

    % Insert date
    \ifx\insertdate\@empty%
    \else%
    \usebeamercolor{date}
    \node[
      text=fg,
      anchor=south east,
      font=\usebeamerfont{date}
    ] at ([shift={(-.5em,.5em)}] current page.south east) {\insertdate};
    \fi

  \end{tikzpicture}
}

% ------------------ %
% Block environments %
% ------------------ %

\defbeamertemplate*{block begin}{corporate}
{
  \par\vskip\medskipamount%
  \usebeamercolor{block body}
  \begin{tikzpicture}
    \node[
      draw=fg,
      fill=bg,
      font=\usebeamerfont{block body},
      inner sep=2ex,
      text width=\paperwidth - 2cm - 4ex,
      minimum width=\paperwidth - 2cm
    ] (BOXCONTENT) \bgroup%
}

\defbeamertemplate*{block end}{corporate}
{
    \egroup;
    \ifx\insertblocktitle\@empty
    \else%
    {
      \usebeamercolor{block title}
      \node[
        fill=bg,
        text=fg,
        anchor=west
      ] at ([shift={(5pt,0)}] BOXCONTENT.north west) {\insertblocktitle};
    }
    \fi
  \end{tikzpicture}
  \vskip\smallskipamount
}

\defbeamertemplate*{block alerted begin}{corporate}
{
  \par\vskip\medskipamount%
  \begin{tikzpicture}
    \usebeamercolor{block alerted body}
    \node[
      draw=fg,
      fill=bg,
      inner sep=2ex,
      text width=\paperwidth - 2cm - 4ex,
      minimum width=\paperwidth - 2cm,
      align=left,
      font=\usebeamerfont{block alerted body}
    ] (BOXCONTENT) \bgroup \noindent%
}

\defbeamertemplate*{block alerted end}{corporate}
{
    \egroup;
    \ifx\insertblocktitle\@empty
    \else%
    {
      \usebeamercolor{block alerted title}
      \node[
        fill=bg,
        anchor=west,
        text=fg
      ] at ([shift={(5pt,0)}] BOXCONTENT.north west) {\insertblocktitle};
    }
    \fi
  \end{tikzpicture}
  \vskip\smallskipamount
}
